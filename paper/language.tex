\section{Syntax}

\Pika{} code is translated into \PikaCore{} before being translated into the target language. \PikaCore{}
is a layout monomorphic version of \Pika{}. While it retains most of the functional syntax of \Pika,
all data structures are manipulated as collections of SSL heaplets. This includes both construction
of data structure values and pattern matching. Also, the argument of every function application in
\PikaCore{} is a literal or a variable. This is because it is entirely given in a kind of ANF, using
the \verb|with-in| construct to introduce an ANF binding.

The syntactic form that introduces an SSL assertion in \PikaCore{} can be seen as a kind of binding
form, the values of which can be ``applied''. For example, $\sslmath{x, y}{x \mapsto y, (x+1) \mapsto z}$
can be seen as an SSL assertion that is parametrized over two locations: $x$ and $y$. Also, the name
$z$ occurs free. When this layout value is applied to two locations, $z$ must remain a fresh variable in
the use-site.

\subsection{Shared Syntax}

The following syntactic forms are shared between the \Pika{} surface language and \PikaCore.

\begin{align*}
  &i ::= \cdots \mid -2 \mid -1 \mid 0 \mid 1 \mid 2 \mid \cdots
  \\
  &b ::= \True{} \mid \False
  \\
  &e ::= x \mid i \mid b \mid \lambda x.\; e
  \\
  &\tau ::= \Int \mid \Bool \mid \tau \ra \tau
\end{align*}

\subsection{\Pika{} Syntax}
\begin{align*}
  &e ::= \cdots \mid \apply_{\alpha}(e) \mid \Lambda (\alpha \isA \layout{X}).\; e
  \\
  &\tau ::= \cdots \mid X \mid \alpha \mid e\; e \mid (\alpha \isA \layout{X}) \Ra \tau
\end{align*}

\subsection{\PikaCore{} Syntax}
\begin{align*}
  &e ::= \cdots \mid e\; \overline{a} \mid \sslmath{\overline{x}}{\overline{h}} \mid \withIn{\{ \overline{x} \} := e} e
  \\
  &a ::= \{ \overline{x} \} \mid \{ i \} \mid \{ b \}
  \\
  &\tau ::= \cdots \mid \SSL(n)
  \\
  &h ::= \ell \mapsto e
  \\
  &\ell ::= x \mid (x + n)
  \\
  &n ::= 0 \mid 1 \mid 2 \mid \cdots
\end{align*}

The construct $\sslmath{\overline{x}}{\overline{h}}$ is an SSL assertion with heaplets $\overline{h}$ and
bound variables $\overline{x}$. Note that it can have free variables as well.

% The general form of a one-parameter \PikaCore{} function definition is
% \begin{align*}
%   &f : \SSL(m) \ra \SSL(n)\\
%   &f\; \{ \overline{\ell \mapsto y} \} \outs \{ \overline{r} \} := e\\
%   &f\; \{ \overline{\ell' \mapsto y} \} \outs \{ \overline{r} \} := e'\\
%   &\cdots
% \end{align*}
%
% \noindent
% where $\overline{r}$ are the names of the output parameters. These output parameters
% must be the same in each branch and it is also required that the number of output parameters matches the type signature: $|\overline{r}| = n$.
%
% Output parameters are given in \PikaCore{} as part of the \verb|with-in| construct:
%
% \begin{align*}
%   \withIn{\{ a, b \} := f\; \{ x \}} e
% \end{align*}
%
% This applies the function $f$ to the input parameter $x$ and gives $a$ and $b$ as output parameters. These two
% output parameters of the application are brought into scope for the \PikaCore{} expression $e$.
%
